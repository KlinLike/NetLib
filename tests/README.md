# Tests æµ‹è¯•æ–‡ä»¶è¯´æ˜

æœ¬ç›®å½•åŒ…å« NetLib é¡¹ç›®çš„å„ç§æµ‹è¯•æ–‡ä»¶å’Œæµ‹è¯•è„šæœ¬ã€‚

---

## ğŸ“ æ–‡ä»¶åˆ—è¡¨

### 1. `test_kvs_array.c`
**ç”¨é€”**: KVS æ•°ç»„å®ç°çš„å•å…ƒæµ‹è¯•ç¨‹åº

**åŠŸèƒ½**:
- æµ‹è¯• `kvs_array` æ¨¡å—çš„æ‰€æœ‰åŠŸèƒ½
- åŒ…å« `create`, `destroy`, `set`, `get`, `mod`, `del`, `exist` ç­‰æ“ä½œçš„æµ‹è¯•
- æä¾›è¯¦ç»†çš„æµ‹è¯•è¾“å‡ºï¼Œæ˜¾ç¤ºæ¯ä¸ªæ“ä½œæ˜¯å¦æˆåŠŸ

**ç¼–è¯‘æ–¹å¼**:
```bash
gcc -o test_kvs_array test_kvs_array.c ../src/kvs_array.c -I../include -Wall
```

**è¿è¡Œæ–¹å¼**:
```bash
./test_kvs_array
```

**ä¾èµ–**:
- `../include/kvstore.h` - KVS å¤´æ–‡ä»¶
- `../src/kvs_array.c` - KVS æ•°ç»„å®ç°

**æµ‹è¯•è¦†ç›–**:
- âœ… åˆ›å»ºå’Œé”€æ¯æ•°ç»„
- âœ… è®¾ç½®é”®å€¼å¯¹
- âœ… è·å–é”®å€¼å¯¹
- âœ… æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
- âœ… ä¿®æ”¹é”®å€¼å¯¹
- âœ… åˆ é™¤é”®å€¼å¯¹
- âœ… é”™è¯¯å¤„ç†ï¼ˆå‚æ•°æ£€æŸ¥ã€é”®ä¸å­˜åœ¨ç­‰ï¼‰

---

### 2. `test_kvs.sh`
**ç”¨é€”**: KVS æ•°ç»„ä¸€é”®ç¼–è¯‘å’Œæµ‹è¯•è„šæœ¬

**åŠŸèƒ½**:
- è‡ªåŠ¨æ¸…ç†æ—§çš„ç¼–è¯‘æ–‡ä»¶
- ç¼–è¯‘ `test_kvs_array.c` æµ‹è¯•ç¨‹åº
- è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºç»“æœ
- æä¾›å½©è‰²è¾“å‡ºï¼Œæ¸…æ™°æ˜¾ç¤ºæµ‹è¯•è¿›åº¦å’Œç»“æœ

**ä½¿ç”¨æ–¹å¼**:
```bash
# æ–¹å¼1: ç›´æ¥è¿è¡Œ
./test_kvs.sh

# æ–¹å¼2: é€šè¿‡ bash è¿è¡Œ
bash test_kvs.sh
```

**è„šæœ¬æµç¨‹**:
1. **æ¸…ç†é˜¶æ®µ**: åˆ é™¤æ—§çš„å¯æ‰§è¡Œæ–‡ä»¶
2. **ç¼–è¯‘é˜¶æ®µ**: ä½¿ç”¨ gcc ç¼–è¯‘æµ‹è¯•ç¨‹åº
3. **æµ‹è¯•é˜¶æ®µ**: è¿è¡Œæµ‹è¯•ç¨‹åº
4. **ç»“æœæ£€æŸ¥**: æ˜¾ç¤ºæµ‹è¯•æ˜¯å¦é€šè¿‡

**è¾“å‡ºè¯´æ˜**:
- ğŸ”µ è“è‰²ï¼šæ ‡é¢˜å’Œåˆ†éš”çº¿
- ğŸŸ¡ é»„è‰²ï¼šé˜¶æ®µæç¤º
- ğŸŸ¢ ç»¿è‰²ï¼šæˆåŠŸä¿¡æ¯
- ğŸ”´ çº¢è‰²ï¼šå¤±è´¥ä¿¡æ¯

**é€€å‡ºç **:
- `0`: æµ‹è¯•æˆåŠŸ
- `1`: ç¼–è¯‘å¤±è´¥æˆ–æµ‹è¯•å¤±è´¥

---

### 3. `test_kvs_parser.c`
**ç”¨é€”**: KVStore åè®®è§£æå™¨çš„å•å…ƒæµ‹è¯•ç¨‹åº

**åŠŸèƒ½**:
- æµ‹è¯•åè®®è§£æå™¨çš„ä¸‰å±‚æ¶æ„ï¼ˆåˆ†è¯å™¨ã€å‘½ä»¤è¯†åˆ«å™¨ã€å‘½ä»¤æ‰§è¡Œå™¨ï¼‰
- æµ‹è¯•æ‰€æœ‰å‘½ä»¤çš„è¯†åˆ«ï¼ˆSET, GET, DEL, MOD, EXIST åŠå…¶å˜ä½“ï¼‰
- æµ‹è¯•é”™è¯¯ç è½¬æ¢
- æµ‹è¯•å®Œæ•´çš„å‘½ä»¤æ‰§è¡Œæµç¨‹

**ç¼–è¯‘æ–¹å¼**:
```bash
gcc -o test_kvs_parser test_kvs_parser.c ../src/kvs_parser.c ../src/kvs_array.c -I../include -Wall
```

**è¿è¡Œæ–¹å¼**:
```bash
./test_kvs_parser
```

**ä¾èµ–**:
- `../include/kvstore.h` - KVS å¤´æ–‡ä»¶
- `../src/kvs_parser.c` - åè®®è§£æå™¨å®ç°
- `../src/kvs_array.c` - KVS æ•°ç»„å®ç°

**æµ‹è¯•è¦†ç›–**:
- âœ… åˆ†è¯å™¨ï¼ˆTokenizerï¼‰æµ‹è¯•
- âœ… å‘½ä»¤è¯†åˆ«å™¨ï¼ˆParserï¼‰æµ‹è¯•
- âœ… é”™è¯¯ä¿¡æ¯è½¬æ¢æµ‹è¯•
- âœ… å®Œæ•´åè®®è§£ææµç¨‹æµ‹è¯•
- âœ… æ•°ç»„å‘½ä»¤: SET, GET, DEL, MOD, EXIST
- âœ… çº¢é»‘æ ‘å‘½ä»¤: RSET, RGET, RDEL, RMOD, REXIST
- âœ… å“ˆå¸Œè¡¨å‘½ä»¤: HSET, HGET, HDEL, HMOD, HEXIST

---

### 4. `test_parser.sh`
**ç”¨é€”**: åè®®è§£æå™¨ä¸€é”®ç¼–è¯‘å’Œæµ‹è¯•è„šæœ¬

**åŠŸèƒ½**:
- è‡ªåŠ¨æ¸…ç†æ—§çš„ç¼–è¯‘æ–‡ä»¶
- ç¼–è¯‘ `test_kvs_parser.c` æµ‹è¯•ç¨‹åº
- è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºç»“æœ
- æä¾›å½©è‰²è¾“å‡ºï¼Œæ¸…æ™°æ˜¾ç¤ºæµ‹è¯•è¿›åº¦å’Œç»“æœ

**ä½¿ç”¨æ–¹å¼**:
```bash
# æ–¹å¼1: ç›´æ¥è¿è¡Œ
./test_parser.sh

# æ–¹å¼2: é€šè¿‡ bash è¿è¡Œ
bash test_parser.sh
```

**è„šæœ¬æµç¨‹**:
1. **æ¸…ç†é˜¶æ®µ**: åˆ é™¤æ—§çš„å¯æ‰§è¡Œæ–‡ä»¶
2. **ç¼–è¯‘é˜¶æ®µ**: ä½¿ç”¨ gcc ç¼–è¯‘æµ‹è¯•ç¨‹åº
3. **æµ‹è¯•é˜¶æ®µ**: è¿è¡Œæµ‹è¯•ç¨‹åº
4. **ç»“æœæ£€æŸ¥**: æ˜¾ç¤ºæµ‹è¯•æ˜¯å¦é€šè¿‡

---

### 5. `echo_client.py`
**ç”¨é€”**: Echo æœåŠ¡å™¨çš„ Python æµ‹è¯•å®¢æˆ·ç«¯

**åŠŸèƒ½**:
- è¿æ¥åˆ° Echo æœåŠ¡å™¨
- å‘é€æµ‹è¯•æ¶ˆæ¯
- æ¥æ”¶å¹¶éªŒè¯æœåŠ¡å™¨å“åº”
- ç”¨äºæµ‹è¯•ç½‘ç»œé€šä¿¡åŠŸèƒ½

**ä½¿ç”¨æ–¹å¼**:
```bash
python3 echo_client.py [host] [port]
```

**ä¾èµ–**:
- Python 3.x
- æ ‡å‡†åº“ï¼š`socket`, `sys`

**é€‚ç”¨åœºæ™¯**:
- æµ‹è¯• Echo æœåŠ¡å™¨çš„åŸºæœ¬åŠŸèƒ½
- éªŒè¯ç½‘ç»œè¿æ¥å’Œæ•°æ®ä¼ è¾“
- å‹åŠ›æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æµ‹è¯• KVS æ•°ç»„æ¨¡å—

**æ¨èæ–¹å¼**ï¼ˆä½¿ç”¨è„šæœ¬ï¼‰:
```bash
cd /root/MyGithub/NetLib
./tests/test_kvs.sh
```

**æ‰‹åŠ¨æ–¹å¼**:
```bash
cd /root/MyGithub/NetLib

# ç¼–è¯‘
gcc -o test_kvs_array tests/test_kvs_array.c src/kvs_array.c -I./include -Wall

# è¿è¡Œ
./test_kvs_array
```

---

### æµ‹è¯• KVS åè®®è§£æå™¨

**æ¨èæ–¹å¼**ï¼ˆä½¿ç”¨è„šæœ¬ï¼‰:
```bash
cd /root/MyGithub/NetLib
./tests/test_parser.sh
```

**æ‰‹åŠ¨æ–¹å¼**:
```bash
cd /root/MyGithub/NetLib

# ç¼–è¯‘
gcc -o test_kvs_parser tests/test_kvs_parser.c src/kvs_parser.c src/kvs_array.c -I./include -Wall

# è¿è¡Œ
./test_kvs_parser
```

---

### æµ‹è¯• Echo æœåŠ¡å™¨

1. å¯åŠ¨æœåŠ¡å™¨ï¼ˆåœ¨ä¸€ä¸ªç»ˆç«¯ï¼‰:
```bash
./server 2000
```

2. è¿è¡Œå®¢æˆ·ç«¯ï¼ˆåœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼‰:
```bash
python3 tests/echo_client.py localhost 2000
```

---

## ğŸ—ï¸ åè®®è§£æå™¨æ¶æ„è¯¦è§£

### ä¸‰å±‚æ¶æ„è®¾è®¡

KVStore åè®®è§£æå™¨é‡‡ç”¨åˆ†å±‚è®¾è®¡ï¼ŒèŒè´£åˆ†ç¦»æ¸…æ™°ï¼š

```
å®¢æˆ·ç«¯è¾“å…¥: "SET name Alice"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬1å±‚ï¼šåˆ†è¯å™¨ (Tokenizer)      â”‚  â†’ ["SET", "name", "Alice"]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬2å±‚ï¼šå‘½ä»¤è¯†åˆ«å™¨ (Parser)     â”‚  â†’ CMD_SET (0)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬3å±‚ï¼šå‘½ä»¤æ‰§è¡Œå™¨ (Executor)   â”‚  â†’ è°ƒç”¨ kvs_array_set()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç”Ÿæˆå“åº”: "OK"
```

### æ¶æ„å±‚æ¬¡è¯´æ˜

#### 1. åˆ†è¯å™¨ (Tokenizer)
- **èŒè´£**: å°†å‘½ä»¤å­—ç¬¦ä¸²åˆ†å‰²æˆtokenæ•°ç»„
- **å®ç°**: ä½¿ç”¨ `strtok()` å‡½æ•°åˆ†è¯
- **æ³¨æ„**: ä¼šç›´æ¥ä¿®æ”¹åŸå­—ç¬¦ä¸²

#### 2. å‘½ä»¤è¯†åˆ«å™¨ (Parser)
- **èŒè´£**: è¯†åˆ«å‘½ä»¤ç±»å‹å¹¶è¿”å›å‘½ä»¤ç´¢å¼•
- **æ”¯æŒå‘½ä»¤**:
  - æ•°ç»„å‘½ä»¤: SET, GET, DEL, MOD, EXIST
  - çº¢é»‘æ ‘å‘½ä»¤: RSET, RGET, RDEL, RMOD, REXIST
  - å“ˆå¸Œè¡¨å‘½ä»¤: HSET, HGET, HDEL, HMOD, HEXIST
- **å®ç°**: ä½¿ç”¨å‘½ä»¤æ•°ç»„è¿›è¡ŒåŒ¹é…

#### 3. å‘½ä»¤æ‰§è¡Œå™¨ (Executor)
- **èŒè´£**: æ‰§è¡Œå…·ä½“çš„å‘½ä»¤å¹¶ç”Ÿæˆå“åº”
- **å®ç°**: è°ƒç”¨åº•å±‚ KVS æ•°æ®ç»“æ„çš„æ¥å£
- **å“åº”æ ¼å¼**:
  - æˆåŠŸ: `OK` æˆ– `OK value`
  - å¤±è´¥: `ERROR: <é”™è¯¯ä¿¡æ¯>`

### è®¾è®¡ä¼˜ç‚¹
- **èŒè´£åˆ†ç¦»**: æ¯å±‚ä¸“æ³¨äºè‡ªå·±çš„èŒè´£ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- **æ˜“äºæµ‹è¯•**: å¯ä»¥å•ç‹¬æµ‹è¯•æ¯ä¸€å±‚çš„åŠŸèƒ½
- **æ˜“äºæ‰©å±•**: æ·»åŠ æ–°å‘½ä»¤åªéœ€ä¿®æ”¹å‘½ä»¤æ•°ç»„å’Œæ‰§è¡Œå™¨
- **æ¨¡å—åŒ–**: å„å±‚ä¹‹é—´æ¥å£æ¸…æ™°ï¼Œä½è€¦åˆé«˜å†…èš

### æ”¯æŒçš„å‘½ä»¤æ ¼å¼

```
SET key value      -> è¿”å›: OK / ERROR: Key already exists
GET key            -> è¿”å›: OK value / ERROR: Key not found
DEL key            -> è¿”å›: OK / ERROR: Key not found
MOD key value      -> è¿”å›: OK / ERROR: Key not found
EXIST key          -> è¿”å›: OK / ERROR: Key not found
```

### è®¾è®¡è€ƒé‡
- ä½¿ç”¨ `strtok` åˆ†è¯ä¼šç›´æ¥ä¿®æ”¹åŸå­—ç¬¦ä¸²
- å‘½ä»¤æ•°ç»„ä½¿ç”¨ `static` é™åˆ¶ä½œç”¨åŸŸ
- å…¨å±€å˜é‡ `global_array` åœ¨ `kvs_parser.c` ä¸­å®šä¹‰
- é”™è¯¯ç ç»Ÿä¸€ä½¿ç”¨æšä¸¾ç±»å‹ç®¡ç†

---

## ğŸ“ æ·»åŠ æ–°æµ‹è¯•

å¦‚æœéœ€è¦æ·»åŠ æ–°çš„æµ‹è¯•æ–‡ä»¶ï¼Œå»ºè®®éµå¾ªä»¥ä¸‹å‘½åè§„èŒƒï¼š

- å•å…ƒæµ‹è¯•ï¼š`test_<æ¨¡å—å>.c`
- é›†æˆæµ‹è¯•ï¼š`integration_test_<åŠŸèƒ½å>.c`
- æµ‹è¯•è„šæœ¬ï¼š`test_<æ¨¡å—å>.sh`
- å®¢æˆ·ç«¯æµ‹è¯•ï¼š`<åè®®å>_client.py`

---

## ğŸ› è°ƒè¯•å»ºè®®

### ä½¿ç”¨ GDB è°ƒè¯•
```bash
gcc -g -o test_kvs_array tests/test_kvs_array.c src/kvs_array.c -I./include
gdb ./test_kvs_array
```

```bash
gcc -g -o test_kvs_parser tests/test_kvs_parser.c src/kvs_parser.c src/kvs_array.c -I./include
gdb ./test_kvs_parser
```

### å†…å­˜æ³„æ¼æ£€æŸ¥
```bash
# éœ€è¦å®‰è£… valgrind
valgrind --leak-check=full --show-leak-kinds=all ./test_kvs_array
valgrind --leak-check=full --show-leak-kinds=all ./test_kvs_parser
```

### æŸ¥çœ‹è¯¦ç»†ç¼–è¯‘ä¿¡æ¯
```bash
gcc -Wall -Wextra -v -o test_kvs_array tests/test_kvs_array.c src/kvs_array.c -I./include
gcc -Wall -Wextra -v -o test_kvs_parser tests/test_kvs_parser.c src/kvs_parser.c src/kvs_array.c -I./include
```

---

## ğŸ“Š æµ‹è¯•çŠ¶æ€

| æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•è„šæœ¬ | çŠ¶æ€ | æœ€åæ›´æ–° |
|------|---------|---------|------|---------|
| KVS Array | `test_kvs_array.c` | `test_kvs.sh` | âœ… é€šè¿‡ | 2025-11-02 |
| KVS Parser | `test_kvs_parser.c` | `test_parser.sh` | âœ… é€šè¿‡ | 2025-11-02 |
| Echo Server | `echo_client.py` | - | âœ… å¯ç”¨ | - |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [kvs_array_issues.md](../docs/kvs_array_issues.md) - KVS æ•°ç»„æ¨¡å—çš„é—®é¢˜ä¿®å¤è®°å½•
- [Process_Log.md](../docs/Process_Log.md) - é¡¹ç›®å¼€å‘æ—¥å¿—
- [kvstore.h](../include/kvstore.h) - KVS æ¨¡å—å¤´æ–‡ä»¶

---

**æ³¨æ„**: æ‰€æœ‰æµ‹è¯•éƒ½åº”è¯¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼Œä»¥ç¡®ä¿æ­£ç¡®çš„ç›¸å¯¹è·¯å¾„ã€‚
